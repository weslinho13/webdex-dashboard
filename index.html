<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>WEbdEX Manager Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
<style>
body { font-family: Arial, sans-serif; background: #121212; color: #fff; text-align: center; padding: 20px; }
button { margin: 5px; padding: 10px 20px; border-radius: 8px; border: none; background: #1e88e5; color: #fff; cursor: pointer; }
input { padding: 5px; margin: 5px; border-radius: 5px; border: 1px solid #ccc; }
.container { margin-top: 20px; }
h2 { color: #00e676; }
table { margin: 10px auto; border-collapse: collapse; width: 80%; }
th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
th { background-color: #333; color: #fff; }
</style>
</head>
<body>

<h1>WEbdEX Manager V4 Dashboard</h1>

<div>
    <button id="connectWallet">Conectar Carteira</button>
    <button id="disconnectWallet">Desconectar Carteira</button>
</div>

<div class="container">
    <h2>Endereço Conectado:</h2>
    <p id="userAddress">Nenhum</p>

    <h2>Saldos</h2>
    <p>Gás: <span id="gasBalance">0</span> MATIC</p>
    <p>WebdEX (Pass): <span id="passBalance">0</span></p>
    <p>Bônus: <span id="bonusBalance">0</span></p>
</div>

<div class="container">
    <h2>Operações</h2>
    <input type="number" id="amountGas" placeholder="Quantidade de Gas">
    <button onclick="addGas()">Adicionar Gas</button>
    <button onclick="removeGas()">Remover Gas</button>
    <br>
    <input type="number" id="amountPass" placeholder="Quantidade de WebdEX">
    <button onclick="removePass()">Remover WebdEX</button>
</div>

<div class="container">
    <h2>Subcontas</h2>
    <input type="text" id="subAccountName" placeholder="Nome da Subconta">
    <button onclick="createSubAccount()">Criar Subconta</button>
    <table>
        <thead>
            <tr><th>ID</th><th>Nome</th><th>Estratégias</th></tr>
        </thead>
        <tbody id="subAccountsTable"></tbody>
    </table>
</div>

<div class="container">
    <h2>Liquidez e Estratégias</h2>
    <input type="text" id="strategyToken" placeholder="Endereço Token da Estratégia">
    <input type="text" id="coin" placeholder="Endereço do Coin">
    <input type="number" id="amountLiquidity" placeholder="Quantidade">
    <button onclick="addLiquidity()">Adicionar Liquidez</button>
    <button onclick="removeLiquidity()">Remover Liquidez</button>
    <br>
    <button onclick="togglePauseStrategy(true)">Pausar Estratégia</button>
    <button onclick="togglePauseStrategy(false)">Despausar Estratégia</button>
</div>

<script>
// === Configurações ===
const managerAddress = "0x9b4314878f58C3Ca53EC0087AcC8c9A30DF773E0";
const managerABI = [ /* ABI resumida funcional como antes */ ];

let provider;
let signer;
let contract;

// === Conectar carteira ===
document.getElementById('connectWallet').onclick = async () => {
    if (window.ethereum) {
        provider = new ethers.providers.Web3Provider(window.ethereum);
        await provider.send("eth_requestAccounts", []);
        signer = provider.getSigner();
        document.getElementById('userAddress').innerText = await signer.getAddress();
        contract = new ethers.Contract(managerAddress, managerABI, signer);
        updateBalances();
        loadSubAccounts();
    } else {
        alert("MetaMask não encontrada!");
    }
};

document.getElementById('disconnectWallet').onclick = () => {
    provider = null;
    signer = null;
    contract = null;
    document.getElementById('userAddress').innerText = "Nenhum";
    document.getElementById('gasBalance').innerText = "0";
    document.getElementById('passBalance').innerText = "0";
    document.getElementById('bonusBalance').innerText = "0";
    document.getElementById('subAccountsTable').innerHTML = "";
};

// === Atualizar saldos ===
async function updateBalances() {
    if (!contract) return;
    const gas = await contract.gasBalance();
    const pass = await contract.passBalance();
    const bonus = await contract.bonusBalance();
    document.getElementById('gasBalance').innerText = parseFloat(ethers.utils.formatEther(gas)).toFixed(4);
    document.getElementById('passBalance').innerText = pass.toString(); // número cheio, como antes
    document.getElementById('bonusBalance').innerText = bonus.toString();
}

// === Funções de operação ===
async function addGas() {
    const amount = document.getElementById('amountGas').value;
    if (!amount) return alert("Informe o valor");
    const tx = await contract.gasAdd({ value: ethers.utils.parseEther(amount) });
    await tx.wait();
    updateBalances();
}

async function removeGas() {
    const amount = document.getElementById('amountGas').value;
    if (!amount) return alert("Informe o valor");
    const tx = await contract.gasRemove(ethers.utils.parseEther(amount));
    await tx.wait();
    updateBalances();
}

async function removePass() {
    const amount = document.getElementById('amountPass').value;
    if (!amount) return alert("Informe o valor");
    const tx = await contract.passRemove(amount);
    await tx.wait();
    updateBalances();
}

// === Subcontas ===
async function createSubAccount() {
    const name = document.getElementById('subAccountName').value;
    if (!name) return alert("Informe o nome da subconta");
    const tx = await contract.createSubAccount(name);
    await tx.wait();
    loadSubAccounts();
}

async function loadSubAccounts() {
    if (!contract) return;
    try {
        const info = await contract.getInfoUser();
        const table = document.getElementById('subAccountsTable');
        table.innerHTML = "";
        if (info.Subcontas) {
            info.Subcontas.forEach(sub => {
                let strategies = sub.estratégias ? sub.estratégias.map(s=>s.strategyToken).join(", ") : "";
                let row = `<tr><td>${sub.id}</td><td>${sub.nome}</td><td>${strategies}</td></tr>`;
                table.innerHTML += row;
            });
        }
    } catch(e) { console.log(e); }
}

// === Liquidez e toggle ===
async function addLiquidity() { /* igual antes */ }
async function removeLiquidity() { /* igual antes */ }
async function togglePauseStrategy(paused) { /* igual antes */ }

</script>
</body>
</html>
