<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>WEbdEX Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
<style>
body { font-family: Arial, sans-serif; background: #121212; color: #fff; text-align: center; padding: 20px; }
button { margin: 5px; padding: 10px 20px; border-radius: 8px; border: none; background: #1e88e5; color: #fff; cursor: pointer; }
input { padding: 5px; margin: 5px; border-radius: 5px; border: 1px solid #ccc; }
.container { margin-top: 20px; }
h2 { color: #00e676; }
</style>
</head>
<body>

<h1>WEbdEX Manager V4</h1>
<div>
    <button id="connectWallet">Conectar Carteira</button>
    <button id="disconnectWallet">Desconectar Carteira</button>
</div>

<div class="container">
    <h2>Endereço Conectado:</h2>
    <p id="userAddress">Nenhum</p>

    <h2>Saldos</h2>
    <p>Gás: <span id="gasBalance">0</span> MATIC</p>
    <p>WebdEX (Pass): <span id="passBalance">0</span></p>
    <p>Bônus: <span id="bonusBalance">0</span></p>
</div>

<div class="container">
    <h2>Operações</h2>
    <input type="number" id="amountGas" placeholder="Quantidade de Gas">
    <button onclick="addGas()">Adicionar Gas</button>
    <button onclick="removeGas()">Remover Gas</button>
    <br>
    <input type="number" id="amountPass" placeholder="Quantidade de WebdEX">
    <button onclick="addPass()">Adicionar WebdEX</button>
    <button onclick="removePass()">Remover WebdEX</button>
</div>

<script>
// === Configurações ===
const managerAddress = "0x9b4314878f58C3Ca53EC0087AcC8c9A30DF773E0";

// ABI corrigida (resumida e funcional)
const managerABI = [
    {"inputs":[{"internalType":"address","name":"_factory","type":"address"}],"stateMutability":"nonpayable","type":"constructor"},
    {"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"uint256","name":"balance","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"value","type":"uint256"},{"indexed":false,"internalType":"bool","name":"increase","type":"bool"},{"indexed":false,"internalType":"bool","name":"is_operation","type":"bool"}],"name":"BalanceGas","type":"event"},
    {"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"uint256","name":"balance","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"value","type":"uint256"},{"indexed":false,"internalType":"bool","name":"increase","type":"bool"},{"indexed":false,"internalType":"bool","name":"is_operation","type":"bool"}],"name":"BalancePass","type":"event"},
    {"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"uint256","name":"balance","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"value","type":"uint256"},{"indexed":false,"internalType":"bool","name":"increase","type":"bool"},{"indexed":false,"internalType":"bool","name":"is_operation","type":"bool"}],"name":"BalanceBonus","type":"event"},
    {"inputs":[],"name":"gasBalance","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
    {"inputs":[],"name":"passBalance","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
    {"inputs":[],"name":"bonusBalance","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
    {"inputs":[],"name":"gasAdd","outputs":[],"stateMutability":"payable","type":"function"},
    {"inputs":[{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"gasRemove","outputs":[],"stateMutability":"nonpayable","type":"function"},
    {"inputs":[{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"passAdd","outputs":[],"stateMutability":"nonpayable","type":"function"},
    {"inputs":[{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"passRemove","outputs":[],"stateMutability":"nonpayable","type":"function"}
];

// Variáveis
let provider;
let signer;
let contract;

// === Conectar carteira ===
document.getElementById('connectWallet').onclick = async () => {
    if (window.ethereum) {
        provider = new ethers.providers.Web3Provider(window.ethereum);
        await provider.send("eth_requestAccounts", []);
        signer = provider.getSigner();
        document.getElementById('userAddress').innerText = await signer.getAddress();
        contract = new ethers.Contract(managerAddress, managerABI, signer);
        updateBalances();
    } else {
        alert("MetaMask não encontrada!");
    }
};

document.getElementById('disconnectWallet').onclick = () => {
    provider = null;
    signer = null;
    contract = null;
    document.getElementById('userAddress').innerText = "Nenhum";
    document.getElementById('gasBalance').innerText = "0";
    document.getElementById('passBalance').innerText = "0";
    document.getElementById('bonusBalance').innerText = "0";
};

// === Atualizar saldos ===
async function updateBalances() {
    if (!contract) return;
    const gas = await contract.gasBalance();
    const pass = await contract.passBalance();
    const bonus = await contract.bonusBalance();
    document.getElementById('gasBalance').innerText = ethers.utils.formatEther(gas);
    document.getElementById('passBalance').innerText = pass;
    document.getElementById('bonusBalance').innerText = bonus;
}

// === Funções de operação ===
async function addGas() {
    const amount = document.getElementById('amountGas').value;
    if (!amount) return alert("Informe o valor");
    const tx = await contract.gasAdd({ value: ethers.utils.parseEther(amount) });
    await tx.wait();
    updateBalances();
}

async function removeGas() {
    const amount = document.getElementById('amountGas').value;
    if (!amount) return alert("Informe o valor");
    const tx = await contract.gasRemove(ethers.utils.parseEther(amount));
    await tx.wait();
    updateBalances();
}

async function addPass() {
    const amount = document.getElementById('amountPass').value;
    if (!amount) return alert("Informe o valor");
    const tx = await contract.passAdd(amount);
    await tx.wait();
    updateBalances();
}

async function removePass() {
    const amount = document.getElementById('amountPass').value;
    if (!amount) return alert("Informe o valor");
    const tx = await contract.passRemove(amount);
    await tx.wait();
    updateBalances();
}

</script>
</body>
</html>
